import { ChecklistItem, CategoryMeta } from '@/types'

export const categoryMeta: Record<string, CategoryMeta> = {
  'Listing & Business Plan': {
    description: 'Admin prerequisites before you can submit anything.',
    orderHint: 'Complete first — everything else depends on these approvals.',
  },
  'Package & Test Org': {
    description: 'Package setup, test org, and credentials for the review team.',
    orderHint: 'Set up after business plan is approved.',
  },
  'Scans & Reports': {
    description: 'Security scans the review team will verify. Submit results with your application.',
    orderHint: 'Run scans after code is feature-complete.',
  },
  'Code Quality': {
    description: 'Security patterns that reviewers check in your source code.',
    orderHint: 'Address during development — retrofitting is painful.',
  },
  'Documentation': {
    description: 'Documents to upload with your submission.',
    orderHint: 'Prepare alongside scans.',
  },
  'Submit': {
    description: 'Final steps to submit and what to expect.',
    orderHint: 'Only after everything above is done.',
  },
}

export const checklistItems: ChecklistItem[] = [
  // ── Listing & Business Plan ──
  {
    id: 'listing-01',
    category: 'Listing & Business Plan',
    title: 'Partner account + Business Plan approval',
    subtitle: 'Both approvals are required before you can submit for Security Review.',
    details: [
      'Create a Partner account at partners.salesforce.com',
      'Submit your Business Plan for Salesforce Legal approval (budget 2–3 weeks)',
      'Complete all company info, pricing model, and licensing type upfront',
      'Incomplete submissions are the #1 cause of delays at this stage',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    howTo: [
      'Go to partners.salesforce.com and sign up for a Partner account',
      'Navigate to Partner Console → Publishing → Business Plans',
      'Fill in company info, pricing model, and licensing type completely',
      'Submit the Business Plan — allow 2–3 weeks for Legal approval',
    ],
    tip: 'Complete all company info, pricing model, and licensing type upfront. Incomplete submissions cause delays.',
    docUrl: 'https://partners.salesforce.com',
    docLabel: 'Salesforce Partner Center',
  },
  {
    id: 'listing-02',
    category: 'Listing & Business Plan',
    title: 'Choose your licensing model',
    subtitle: 'Decide before submitting the business plan — changing later is hard.',
    details: [
      'Checkout = Salesforce handles billing (~15% rev share)',
      'ISVForce = you invoice separately via COA',
      'OEM = you bundle Salesforce platform licenses with your app',
      'Licensing model affects your business plan review scope',
    ],
    severity: 'recommended',
    severityNote: 'Decide early',
    docUrl: 'https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/appexchange_checkout.htm',
    docLabel: 'ISVforce Guide — Licensing',
  },
  {
    id: 'listing-03',
    category: 'Listing & Business Plan',
    title: 'Complete your AppExchange listing',
    subtitle: 'The listing must be fully filled out before security review submission.',
    details: [
      'Create the listing in Partner Console with all required sections',
      'Include: app name, description, screenshots, compatibility, pricing, and logo',
      'Link your managed package and select the exact version for review',
      'The version you link is what gets reviewed — double-check it',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    howTo: [
      'Log in to [Partner Console](https://partners.salesforce.com) → Publishing',
      'Click your listing or create a new one',
      'Fill out all required sections: name, description, screenshots, compatibility, pricing, logo',
      'Under Technologies, click "Link Package" and select the managed package version you want reviewed',
      'If the version doesn\'t appear, confirm it uses Major.Minor format (e.g. 1.2, not 1.2.3)',
    ],
    tip: 'If your package isn\'t showing, check that you\'re using Major.Minor versioning.',
  },

  // ── Package & Test Org ──
  {
    id: 'package-01',
    category: 'Package & Test Org',
    title: 'Use a Managed Package with Major.Minor versioning',
    subtitle: 'Only managed packages are accepted — not beta, unmanaged, or unlocked.',
    details: [
      'Must be a managed package (1GP or 2GP)',
      'Use Major.Minor releases (e.g. 1.2) — patch versions are filtered out',
      'Beta and unmanaged packages cannot be submitted',
      'The submission portal will not show patch versions',
    ],
    howTo: [
      'For 1GP: In Setup → Package Manager, create a managed package and upload with a Major.Minor version number',
      'For 2GP: In sfdx-project.json, set versionNumber to "X.Y.0.NEXT" (e.g. "1.2.0.NEXT")',
      'Create a release version: sf package version create --package MyPkg --installation-key-bypass --wait 10',
      'Promote it: sf package version promote --package MyPkg@1.2.0-1',
      'Do not use patch versions — the submission portal filters them out',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['managed_package_1gp', 'managed_package_2gp'],
  },
  {
    id: 'package-02',
    category: 'Package & Test Org',
    title: 'Set up namespace and Dev Hub (2GP)',
    subtitle: 'Register a namespace and enable 2GP on your Partner Business Org.',
    details: [
      'Register a namespace in a Developer Edition org',
      'Link namespace to your Dev Hub and enable 2GP on your PBO',
      'You cannot submit from a trial Dev Hub — activate PBO via Partner Community Case',
      'Converting 1GP→2GP inherits security review approval',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    tip: 'Use a throwaway namespace during development. Converting 1GP→2GP inherits security review approval.',
    docUrl: 'https://developer.salesforce.com/docs/atlas.en-us.pkg2_dev.meta/pkg2_dev/sfdx_dev_dev2gp.htm',
    docLabel: '2GP Developer Guide',
    appTypes: ['managed_package_2gp'],
  },
  {
    id: 'package-03',
    category: 'Package & Test Org',
    title: 'Dev Hub must not be a Trial Org',
    subtitle: 'PBO activation is required — trial Dev Hubs are rejected.',
    details: [
      'Your Dev Hub org must be activated as a Partner Business Org (PBO)',
      'Activate PBO by filing a case in Partner Community',
      'Trial orgs cannot be used for submission',
      'This is a common gotcha for first-time 2GP submitters',
    ],
    howTo: [
      'Log in to the Salesforce Partner Community at partners.salesforce.com',
      'Click "Support" → "Create a Case"',
      'Select case type: "Partner Program Support"',
      'In the description write: "Please activate my PBO; Org ID: [your org ID]"',
      'Find your Org ID in Setup → Company Information',
      'Wait for confirmation (typically 1–3 business days)',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['managed_package_2gp'],
  },
  {
    id: 'package-04',
    category: 'Package & Test Org',
    title: 'Multi-package: each package needs its own review',
    subtitle: 'Only split into multiple packages if you have a compelling reason.',
    details: [
      'Each package must pass security review independently',
      'Reviewers need a separate test org per package',
      'Consider using a base + extension pattern only when necessary',
    ],
    severity: 'recommended',
    severityNote: 'Plan ahead',
    appTypes: ['managed_package_1gp', 'managed_package_2gp', 'base_extension'],
  },
  {
    id: 'package-05',
    category: 'Package & Test Org',
    title: 'Prepare the test org for reviewers',
    subtitle: 'Treat reviewers like a customer doing a test drive.',
    details: [
      'Install the correct package version in a clean org',
      'Create realistic test data that demonstrates all features',
      'Provide working admin credentials (username + password)',
      'Even if you don\'t have a managed package, a Salesforce test org is still required',
      'Only include packages directly related to your submission',
    ],
    howTo: [
      'Create a fresh org using the [2FA-disabled trial template](https://salesforce.quip.com/pfqeA8kRTraY) or a [Developer Edition](https://developer.salesforce.com/signup)',
      'Install the exact package version you\'re submitting for review',
      'Create realistic test data — enough to demonstrate all features end-to-end',
      'Set up an admin user with a simple username and password (no SSO)',
      'Log in and verify all features work before submitting the credentials',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    tip: 'A Salesforce test org is required even if you don\'t have a managed package (e.g. browser extensions, external web apps). The submission form verifies credentials during submission.',
  },
  {
    id: 'package-06',
    category: 'Package & Test Org',
    title: '2FA-disabled test org',
    subtitle: 'Reviewers cannot use MFA — disable it or use the special trial template.',
    details: [
      'Use the Salesforce trial template that creates a 2FA-disabled org',
      'Alternatively, disable MFA in a Developer Edition org via Setup > Identity > Session Settings',
      'Reviewers will not be able to log in if MFA is enabled',
      'This is one of the most common reasons for review delays',
    ],
    howTo: [
      'Option A: [Follow this quick guide](https://salesforce.quip.com/pfqeA8kRTraY) to create a 2FA-disabled org using the security review trial template',
      'Option B: [Create a Developer Edition org](https://developer.salesforce.com/signup) and then [follow these instructions](https://salesforce.quip.com/XaCHAb5Yo15Y) to disable 2FA',
      'In Setup, search for "Session Settings"',
      'Uncheck "Require MFA for all direct UI logins"',
      'Also check Setup → Identity → Multi-Factor Authentication to ensure no MFA policies are active',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    docUrl: 'https://help.salesforce.com/s/articleView?id=sf.security_require_two_factor_authentication.htm',
    docLabel: 'MFA Settings Guide',
  },
  {
    id: 'package-07',
    category: 'Package & Test Org',
    title: 'Provide external service credentials and app installers',
    subtitle: 'Reviewers will pen-test your external endpoints — no debug mode.',
    details: [
      'Provide working test credentials for any external APIs or web apps',
      'For mobile apps: TestFlight (iOS) or APK (Android)',
      'External web apps must NOT be in debug mode',
      'Reviewers will actively pen-test all external endpoints',
    ],
    howTo: [
      'Create dedicated test accounts with full access for the review team',
      'For iOS apps: set up [TestFlight](https://developer.apple.com/testflight) access',
      'For Android apps: provide a direct APK download or Google Play link',
      'Check the [testing scope guide](https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_test_all.htm) to confirm what\'s in scope',
      'Ensure all external services are running in production mode (not debug/staging)',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['external_web_app', 'api_endpoints', 'apex_callouts', 'mobile_ios', 'mobile_android', 'desktop_app'],
  },
  {
    id: 'package-08',
    category: 'Package & Test Org',
    title: 'Desktop app: provide RDP credentials',
    subtitle: 'Provide remote access to a configured VM with your app installed.',
    details: [
      'Set up a VM with your desktop application installed and configured',
      'Provide RDP credentials (host, username, password)',
      'Ensure the VM is accessible from the internet during the review period',
      'Pre-configure the app so reviewers can start testing immediately',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['desktop_app'],
  },
  {
    id: 'package-09',
    category: 'Package & Test Org',
    title: 'Browser extension: provide store link or download',
    subtitle: 'Public store link preferred — direct download acceptable.',
    details: [
      'Provide a public Chrome Web Store / Firefox Add-ons link if available',
      'If not yet published, provide a direct download (.crx / .xpi)',
      'Include installation instructions for sideloading if needed',
      'Ensure the extension works with the latest browser version',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['browser_extension'],
  },
  {
    id: 'package-10',
    category: 'Package & Test Org',
    title: 'Marketing Cloud credentials',
    subtitle: 'Provide a test account at mc.exacttarget.com with special 2FA email.',
    details: [
      'Create a user in your Marketing Cloud instance at mc.exacttarget.com',
      'Set the 2FA email to marketingcloud2fa@salesforce.com',
      'Reviewers will use this email to receive 2FA codes',
      'Provide the username and password in your submission',
    ],
    howTo: [
      'Log in to your Marketing Cloud instance at mc.exacttarget.com',
      'Go to Setup → Users → Create a new user for the review team',
      'Set the email address to marketingcloud2fa@salesforce.com',
      'Assign appropriate permissions so the reviewer can test all features',
      'Note the username and password — include them in your submission',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['marketing_cloud'],
  },
  {
    id: 'package-11',
    category: 'Package & Test Org',
    title: 'Quip app: provide source code and test instance',
    subtitle: 'Un-minified source code zip + working Quip test instance.',
    details: [
      'Upload a zip of the un-minified source code',
      'Provide access to a Quip test instance with the app installed',
      'Include credentials for the test instance',
      'Minified/obfuscated code will be rejected',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['quip_app'],
  },
  {
    id: 'package-12',
    category: 'Package & Test Org',
    title: 'External 2FA handling for test accounts',
    subtitle: 'Disable 2FA for the test account or route codes to a Salesforce email.',
    details: [
      'If your external service uses 2FA, disable it for the test account',
      'Alternatively, set the 2FA destination to marketingcloud2fa@salesforce.com',
      'Reviewers cannot receive SMS or authenticator app codes',
      'Document how to access the account without 2FA in your submission notes',
    ],
    severity: 'important',
    severityNote: 'Commonly flagged',
    appTypes: ['external_web_app', 'api_endpoints', 'marketing_cloud'],
  },

  // ── Scans & Reports ──
  {
    id: 'scan-01',
    category: 'Scans & Reports',
    title: 'Checkmarx (Source Code) scan results',
    subtitle: 'Submit via Partner Security Portal — the most scrutinized scan.',
    details: [
      'Run the Checkmarx scan through the Partner Security Portal',
      'Upload a false positives document for any issues above Code Quality severity',
      'If your app has no scannable code, upload a confirmation document explaining why',
      'Checkmarx results are reviewed manually — vague explanations are rejected',
      'Plan for 1–2 iterations on the false positives document',
    ],
    howTo: [
      'Go to the [Partner Security Portal](https://security.my.salesforce-sites.com/sourcescanner/) and log in with your Partner credentials',
      'Upload your source code package for scanning',
      'Wait for the scan to complete and review the results',
      'Fix any Critical/High findings, or prepare a false positives document with specific justifications',
      'For more info, visit the [Partner Security Portal Help Page](https://security.my.salesforce-sites.com/sourcescanner/SourceScannerHelp)',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    docUrl: 'https://security.my.salesforce-sites.com/sourcescanner/',
    docLabel: 'Partner Security Portal',
    appTypes: ['managed_package_1gp', 'managed_package_2gp', 'external_web_app'],
  },
  {
    id: 'scan-02',
    category: 'Scans & Reports',
    title: 'Code Analyzer v5+ results',
    subtitle: 'Use Salesforce Code Analyzer v5 or higher — older versions are not accepted.',
    details: [
      'Install or migrate to Salesforce Code Analyzer v5+',
      'Run against all Apex, LWC, Aura, and JavaScript in your package',
      'Includes PMD, ESLint, RetireJS, and Graph Engine rules',
      'Fix all Critical and High findings before submitting',
      'Upload the HTML report with your submission',
    ],
    howTo: [
      '[Install SFCAv5](https://developer.salesforce.com/docs/platform/salesforce-code-analyzer/guide/analyze.html#install-the-cli-plugin-and-view-the-commands): sf plugins install @salesforce/sfdx-scanner',
      'If migrating from v4, follow the [SFCAv4 to SFCAv5 migration guide](https://developer.salesforce.com/docs/platform/salesforce-code-analyzer/guide/migrate.html)',
      '[Follow these steps to run a scan](https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_code_analyzer_scan.htm)',
      'Run: sf scanner run --target "force-app" --format html --outfile scan-report.html',
      'Review the HTML report and fix all Critical/High findings',
      'Upload the clean report with your submission',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    codeExamples: [
      {
        label: 'Install & run',
        good: 'sf plugins install @salesforce/sfdx-scanner\nsf scanner run --target "force-app" --format html --outfile scan-report.html',
      },
    ],
    docUrl: 'https://developer.salesforce.com/docs/platform/salesforce-code-analyzer/guide/code-analyzer.html',
    docLabel: 'Code Analyzer v5 Guide',
    appTypes: ['managed_package_1gp', 'managed_package_2gp'],
  },
  {
    id: 'scan-03',
    category: 'Scans & Reports',
    title: 'DAST scan for external web apps',
    subtitle: 'Run OWASP ZAP, Burp Suite, or similar on all external endpoints.',
    details: [
      'Use OWASP ZAP (free), Burp Suite, or another DAST scanner',
      'Scan all external-facing URLs your app connects to',
      'Upload a false positives document for any High severity issues',
      'Salesforce may also run their own Chimera scan via Partner Security Portal',
      'Fix all Critical findings before submitting',
    ],
    howTo: [
      'Download [OWASP ZAP](https://www.zaproxy.org/) (free) or [Burp Suite](https://portswigger.net/burp)',
      'Configure the scanner to target all your external-facing URLs',
      'Run a full scan and export the results',
      'Ensure all endpoints are covered per [Salesforce testing scope guidance](https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_test_all.htm)',
      'Prepare a false positives document for any High severity issues that remain',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    docUrl: 'https://www.zaproxy.org/',
    docLabel: 'OWASP ZAP',
    appTypes: ['external_web_app', 'api_endpoints', 'apex_callouts'],
  },
  {
    id: 'scan-04',
    category: 'Scans & Reports',
    title: 'Qualys SSL scan',
    subtitle: 'Salesforce runs this on all external endpoints — you must get grade A.',
    details: [
      'Run the Qualys SSL Labs test on every external endpoint',
      'You must achieve grade A or higher',
      'Common failures: TLS 1.0/1.1 enabled, weak cipher suites, expired certs',
      'Salesforce will independently verify this — don\'t skip it',
      'Fix SSL configuration before submitting',
    ],
    howTo: [
      'Go to the [Qualys SSL Labs test](https://www.ssllabs.com/ssltest/) and enter your endpoint URL',
      'Wait for the scan to complete (may take a few minutes)',
      'If grade is below A: disable TLS 1.0/1.1, remove weak ciphers, renew expired certs',
      'Re-run until all endpoints show grade A or higher',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    docUrl: 'https://www.ssllabs.com/ssltest/',
    docLabel: 'Qualys SSL Labs Test',
    appTypes: ['external_web_app', 'api_endpoints', 'apex_callouts'],
  },

  // ── Code Quality ──
  {
    id: 'code-01',
    category: 'Code Quality',
    title: 'Enforce CRUD and FLS on every data access',
    subtitle: 'The #1 reason apps fail security review.',
    details: [
      'Every SOQL query must respect object-level (CRUD) and field-level security (FLS)',
      'Use WITH USER_MODE on SOQL (Spring \'23+) — the preferred approach',
      'Fall back to WITH SECURITY_ENFORCED for older API versions',
      'Wrap DML with Security.stripInaccessible() before insert/update',
    ],
    howTo: [
      'Search all .cls files for SOQL queries: grep -rn "\\[SELECT" force-app/',
      'Add WITH USER_MODE to every SOQL query (Spring \'23+ API)',
      'For older API: replace with WITH SECURITY_ENFORCED',
      'Wrap all DML (insert/update/upsert) with Security.stripInaccessible()',
      'Run [Code Analyzer](https://developer.salesforce.com/docs/platform/salesforce-code-analyzer/guide/code-analyzer.html) — Graph Engine catches most CRUD/FLS violations',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    codeExamples: [
      {
        label: 'SOQL query',
        bad: '// No permission check\nList<Account> accs = [SELECT Id, Revenue__c FROM Account];',
        good: '// User mode enforces CRUD + FLS\nList<Account> accs = [SELECT Id, Revenue__c FROM Account WITH USER_MODE];',
      },
      {
        label: 'DML operation',
        bad: 'insert newRecords;',
        good: 'SObjectAccessDecision decision = Security.stripInaccessible(\n  AccessType.CREATABLE, newRecords\n);\ninsert decision.getRecords();',
      },
    ],
    tip: 'Code Analyzer\'s Graph Engine detects most CRUD/FLS violations automatically.',
    docUrl: 'https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_perms_enforcing.htm',
    docLabel: 'Enforce Object & Field Permissions',
    appTypes: ['managed_package_1gp', 'managed_package_2gp'],
  },
  {
    id: 'code-02',
    category: 'Code Quality',
    title: 'Declare sharing on all Apex classes',
    subtitle: 'Implicit sharing is treated as a security finding.',
    details: [
      'Always use "with sharing" or "without sharing" explicitly on every class',
      'Never leave sharing implicit — reviewers flag it every time',
      'Document any "without sharing" usage in your false positives document',
      'Inner classes inherit the outer class sharing unless explicitly overridden',
    ],
    howTo: [
      'Search for classes missing sharing: grep -rn "public class\\|global class" force-app/ | grep -v "sharing"',
      'Add "with sharing" to every class that should respect record access',
      'Use "without sharing" only when the class must bypass sharing (e.g., platform utility classes)',
      'Document every "without sharing" class in your false positives document with justification',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    codeExamples: [
      {
        label: 'Apex class declaration',
        bad: '// Implicit sharing — will be flagged\npublic class MyController {\n  // ...\n}',
        good: '// Explicit sharing declaration\npublic with sharing class MyController {\n  // ...\n}',
      },
    ],
    appTypes: ['managed_package_1gp', 'managed_package_2gp'],
  },
  {
    id: 'code-03',
    category: 'Code Quality',
    title: 'Prevent SOQL injection',
    subtitle: 'Never concatenate user input into SOQL strings.',
    details: [
      'Use bind variables (:variable) instead of string concatenation',
      'If dynamic SOQL is unavoidable, use String.escapeSingleQuotes()',
      'Avoid SOQL inside FOR loops (bulkification issue)',
      'Code Analyzer detects most SOQL injection patterns',
    ],
    howTo: [
      'Search for dynamic SOQL: grep -rn "Database.query" force-app/',
      'Replace string concatenation with bind variables where possible: WHERE Name = :userInput',
      'If dynamic SOQL is unavoidable, wrap user input with String.escapeSingleQuotes()',
      'Run Code Analyzer to catch any remaining SOQL injection patterns',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    codeExamples: [
      {
        label: 'Dynamic SOQL',
        bad: '// User input concatenated — SOQL injection!\nString q = \'SELECT Id FROM Account WHERE Name = \\\'\' + userInput + \'\\\'\';\nList<Account> accs = Database.query(q);',
        good: '// Bind variable — safe from injection\nList<Account> accs = [SELECT Id FROM Account WHERE Name = :userInput];',
      },
    ],
    docUrl: 'https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/pages_security_tips_soql_injection.htm',
    docLabel: 'SOQL Injection Prevention',
    appTypes: ['managed_package_1gp', 'managed_package_2gp'],
  },
  {
    id: 'code-04',
    category: 'Code Quality',
    title: 'Lightning CSP compliance',
    subtitle: 'No inline JavaScript, no CDN loading, no fixed positioning hacks.',
    details: [
      'No inline JavaScript (<script>) or inline event handlers (onclick="...")',
      'No inline CSS style attributes for layout hacks',
      'Upload all JS libraries as Static Resources (no CDN loading)',
      'Register external resources as CSP Trusted Sites',
      'No fixed/absolute positioning that breaks the Lightning container',
    ],
    howTo: [
      'Search for inline JS: grep -rn "onclick=\\|<script" force-app/',
      'Replace inline event handlers with LWC event bindings: onclick={handleClick}',
      'Download any CDN-loaded libraries and upload them as [Static Resources](https://developer.salesforce.com/docs/atlas.en-us.lightning.meta/lightning/apex_static_resources.htm)',
      'Register external domains in Setup → CSP Trusted Sites',
      'Replace fixed/absolute positioning with Lightning layout components',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    codeExamples: [
      {
        label: 'Event handling in LWC',
        bad: '<!-- Inline JS — blocked by CSP -->\n<button onclick="handleClick()">Save</button>',
        good: '<!-- LWC event handler -->\n<button onclick={handleClick}>Save</button>',
      },
    ],
    docUrl: 'https://developer.salesforce.com/docs/atlas.en-us.lightning.meta/lightning/csp_trusted_sites.htm',
    docLabel: 'CSP Trusted Sites',
    appTypes: ['lightning_components', 'managed_package_1gp', 'managed_package_2gp'],
  },
  {
    id: 'code-05',
    category: 'Code Quality',
    title: 'No vulnerable JavaScript libraries',
    subtitle: 'One of the most common failures — audit all bundled JS libraries.',
    details: [
      'Audit all bundled JS libraries (especially jQuery) against known CVEs',
      'Use Retire.js or Code Analyzer to detect vulnerable versions',
      'Run npx retire in your project before submitting',
      'Replace or upgrade any library with known vulnerabilities',
    ],
    howTo: [
      'Run npx retire --js in your project root to scan for known vulnerabilities',
      'Check Static Resources for bundled JS libraries (especially jQuery, lodash, moment)',
      'Upgrade any flagged library to a patched version',
      'If you can\'t upgrade, document why in your false positives document',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    tip: 'Run npx retire in your project before submitting.',
    docUrl: 'https://developer.salesforce.com/docs/platform/salesforce-code-analyzer/guide/get-started.html',
    docLabel: 'Code Analyzer (includes RetireJS)',
    appTypes: ['lightning_components', 'managed_package_1gp', 'managed_package_2gp'],
  },
  {
    id: 'code-06',
    category: 'Code Quality',
    title: 'XSS and CSRF protection',
    subtitle: 'Never render unsanitized user input in the DOM.',
    details: [
      'Never use innerHTML or apex:outputText with escape="false"',
      'Use template expressions in LWC — they auto-escape',
      'Implement CSRF tokens for all state-changing operations on external endpoints',
      'Sanitize all user input on the server side',
    ],
    howTo: [
      'Search for innerHTML usage: grep -rn "innerHTML\\|escape=.false" force-app/',
      'Replace innerHTML with LWC template bindings: <div>{safeValue}</div>',
      'In Visualforce: remove escape="false" from apex:outputText tags',
      'For external endpoints: add CSRF token validation to all POST/PUT/DELETE handlers',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    codeExamples: [
      {
        label: 'Rendering user input in LWC',
        bad: '// innerHTML — XSS vulnerability!\nthis.template.querySelector("div").innerHTML = userInput;',
        good: '<!-- Template expression — auto-escaped -->\n<div>{userInput}</div>',
      },
    ],
    docUrl: 'https://developer.salesforce.com/docs/atlas.en-us.secure_coding_guide.meta/secure_coding_guide/secure_coding_cross_site_scripting.htm',
    docLabel: 'Salesforce Secure Coding — XSS',
  },
  {
    id: 'code-07',
    category: 'Code Quality',
    title: 'HTTPS + TLS 1.2+ on all external endpoints',
    subtitle: 'HTTP callouts or TLS < 1.2 are automatic failures.',
    details: [
      'Every external endpoint must use HTTPS with TLS 1.2 or higher',
      'Disable TLS 1.0 and 1.1 on your servers',
      'Ensure valid, non-expired SSL certificates',
      'External services will be pen-tested — no debug mode',
    ],
    howTo: [
      'Search codebase for http:// URLs: grep -rn "http://" force-app/ — replace all with https://',
      'Run the [Qualys SSL test](https://www.ssllabs.com/ssltest/) on every external endpoint',
      'In your server config, disable TLS 1.0 and 1.1 (keep only 1.2+)',
      'Verify SSL certificates are valid and not expiring within the review period',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['external_web_app', 'api_endpoints', 'apex_callouts'],
  },
  {
    id: 'code-08',
    category: 'Code Quality',
    title: 'No hardcoded secrets or sensitive data leaks',
    subtitle: 'Use Named Credentials — never hardcode API keys or passwords.',
    details: [
      'Never hardcode API keys, passwords, or tokens in source code',
      'Use Named Credentials or Protected Custom Settings for secrets',
      'Never send Session IDs to external systems',
      'No sensitive data in URLs, logs, or debug statements',
      'Remove commented-out code blocks containing secrets',
    ],
    howTo: [
      'Search for hardcoded secrets: grep -rn "password\\|apiKey\\|secret\\|token.*=.*[\'\\"]" force-app/',
      'Replace hardcoded endpoints with [Named Credentials](https://help.salesforce.com/s/articleView?id=sf.nc_named_creds_and_ext_creds.htm&type=5): callout:My_Service/api/data',
      'Search for Session ID leaks: grep -rn "UserInfo.getSessionId\\|{!\\$Api.Session_ID}" force-app/',
      'Remove any debug statements that log sensitive data: grep -rn "System.debug.*password\\|System.debug.*token" force-app/',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    codeExamples: [
      {
        label: 'Storing API credentials',
        bad: '// Hardcoded secret — will be flagged\nString apiKey = \'sk-abc123secret\';',
        good: '// Named Credential — secrets managed by the platform\nHttpRequest req = new HttpRequest();\nreq.setEndpoint(\'callout:My_Service/api/data\');\n// Auth header added automatically',
      },
    ],
    docUrl: 'https://help.salesforce.com/s/articleView?id=sf.nc_named_creds_and_ext_creds.htm&type=5',
    docLabel: 'Named Credentials',
  },

  // ── Documentation ──
  {
    id: 'doc-01',
    category: 'Documentation',
    title: 'Solution architecture document or user guide',
    subtitle: 'Provide whatever helps reviewers understand how your solution works and how to use it.',
    details: [
      'Upload to the "Solution Architecture" section of the submission form',
      'For complex integrations: a diagram showing data flows, components, and security measures',
      'For simpler apps: a brief user guide or written instructions may be more appropriate',
      'Include what data is stored where (Salesforce vs external)',
      'Document all integration points and authentication methods',
      'The more info you provide, the smoother your review will likely go',
    ],
    howTo: [
      'Decide what format is most helpful: architecture diagram, user guide, or both',
      'For diagrams: create a PDF/Word doc showing all system components and data flows',
      'For user guides: write step-by-step instructions on how to install and use your solution',
      'Document authentication at each integration point (OAuth, Named Credentials, API keys)',
      'Include a section on how to test: which features to try, what test data to use',
      'Upload to the "Solution Architecture" section of the submission form',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
  },
  {
    id: 'doc-02',
    category: 'Documentation',
    title: 'Code Analyzer report',
    subtitle: 'Upload the HTML report — fix or document every finding.',
    details: [
      'Run Code Analyzer and generate the HTML report',
      'Fix all Critical and High findings before submitting',
      'For remaining findings, include justifications in your false positives doc',
      'Vague explanations like "not applicable" will be rejected',
    ],
    howTo: [
      'Run: sf scanner run --target "force-app" --format html --outfile scan-report.html',
      'Open scan-report.html and review all findings by severity',
      'Fix all Critical and High severity findings in your code',
      'For remaining findings, add justifications to your [false positives document](https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_false_positives.htm)',
      'Upload the clean HTML report with your submission',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    codeExamples: [
      {
        label: 'Generate HTML report',
        good: 'sf scanner run --target "force-app/**/*.cls" \\\n  --format html \\\n  --outfile scan-report.html',
      },
    ],
    docUrl: 'https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_false_positives.htm',
    docLabel: 'False Positives Guide',
    appTypes: ['managed_package_1gp', 'managed_package_2gp'],
  },
  {
    id: 'doc-03',
    category: 'Documentation',
    title: 'False positives document',
    subtitle: 'Explain every scan finding you believe is a false positive — with specific justification.',
    details: [
      'Create a document for each finding you dispute',
      'Include the exact finding ID, file, and line number',
      'Explain WHY it\'s a false positive with technical justification',
      'Generic dismissals ("not a real issue") are rejected immediately',
      'Group by scan type (Checkmarx, Code Analyzer, DAST)',
    ],
    howTo: [
      'Create a document (PDF/Word) with a table: Finding ID | File:Line | Rule | Justification',
      'For each finding, explain the specific technical reason it\'s a false positive',
      'Example: "CRUD violation in MyBatchJob.cls:42 — this class runs in system context via a scheduled job and requires access to all records"',
      'Group findings by scan tool (Checkmarx, Code Analyzer, DAST)',
      'Reference the [false positives guide](https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_false_positives.htm) for formatting expectations',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    docUrl: 'https://developer.salesforce.com/docs/atlas.en-us.packagingGuide.meta/packagingGuide/security_review_false_positives.htm',
    docLabel: 'False Positives Guide',
    appTypes: ['managed_package_1gp', 'managed_package_2gp', 'external_web_app'],
  },
  {
    id: 'doc-04',
    category: 'Documentation',
    title: 'Supplementary docs (CRUD/FLS bypasses, external APIs, mobile)',
    subtitle: 'Document intentional security bypasses and external integrations.',
    details: [
      'Document any intentional CRUD/FLS bypasses with justification',
      'For external APIs: endpoint, auth method, data exchanged',
      'For mobile apps: device permissions, local data storage, data flow',
      'For "without sharing" classes: explain why sharing bypass is needed',
    ],
    severity: 'recommended',
    severityNote: 'Smoother review',
    appTypes: ['managed_package_1gp', 'managed_package_2gp', 'external_web_app', 'api_endpoints', 'apex_callouts', 'mobile_ios', 'mobile_android'],
  },
  {
    id: 'doc-05',
    category: 'Documentation',
    title: 'API documentation for external endpoints',
    subtitle: 'Provide sample HTTP requests and responses for all endpoints.',
    details: [
      'Document every API endpoint your app exposes or consumes',
      'Include sample HTTP requests with all required headers',
      'Include sample responses for success and error cases',
      'Document authentication flow (OAuth, API key, etc.)',
    ],
    severity: 'recommended',
    severityNote: 'Smoother review',
    appTypes: ['api_endpoints', 'external_web_app', 'apex_callouts'],
  },

  // ── Submit ──
  {
    id: 'submit-01',
    category: 'Submit',
    title: 'Verify all scans pass with acceptable results',
    subtitle: 'All scans must be run and results uploaded before submitting.',
    details: [
      'Checkmarx scan completed with no Critical findings (or documented false positives)',
      'Code Analyzer v5+ with no Critical findings',
      'DAST scan for external endpoints (if applicable)',
      'Qualys SSL grade A on all external endpoints (if applicable)',
      'All false positives documented with specific justifications',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
  },
  {
    id: 'submit-02',
    category: 'Submit',
    title: 'Pay fee and submit via Partner Console',
    subtitle: 'Paid apps: $999 per attempt. Free apps: currently no fee.',
    details: [
      'Submit through Partner Console > Technologies > Security Review wizard',
      'Do not submit via a support case — it won\'t be processed',
      'Paid apps require a $999 fee per submission attempt',
      'Free apps currently have no submission fee',
    ],
    howTo: [
      'Log in to Partner Console at partners.salesforce.com',
      'Navigate to Publishing → Your Listing → Technologies tab',
      'Click "Start Security Review" and follow the wizard',
      'Upload all required scans, documents, and credentials',
      'Pay the $999 fee (paid listings only) and submit',
    ],
    severity: 'critical',
    severityNote: 'Auto-reject',
    appTypes: ['paid_listing'],
  },
  {
    id: 'submit-03',
    category: 'Submit',
    title: 'Plan for 6–9 week queue and resubmission',
    subtitle: 'Don\'t submit a week before launch — the queue is long.',
    details: [
      'Current queue time is approximately 6–9 weeks',
      'If you fail, edit the existing submission (don\'t create a new one) to skip the initial queue',
      'Most packages pass on the second attempt',
      'You can book office hours with the security review team (3 weeks notice required)',
    ],
    severity: 'recommended',
    severityNote: 'Good practice',
    tip: 'You can book office hours with the security review team if you\'re stuck — requires 3 weeks notice.',
    docUrl: 'https://security.my.salesforce-sites.com/sourcescanner/',
    docLabel: 'Security Review Office Hours',
  },
]

export const categories = [
  'Listing & Business Plan',
  'Package & Test Org',
  'Scans & Reports',
  'Code Quality',
  'Documentation',
  'Submit',
]
